<!DOCTYPE html>
<html lang="zh-CN" class="noscroll">
<head>
<meta charset="utf-8" />
<title>陪明星出击</title>
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui,viewport-fit=cover" />
<link rel="stylesheet" href="../style/css/attack.css"  />


</head>
<body ontouchstart >
	<div class="page_wrap">
		<div class="page_header">
			<h1 class="page_title">陪明星出击</h1>
			<button class="btn_link btn_rule">活动规则</button>
			<button class="btn_link btn_property">我的资产</button>
		</div>

		<div class="mod_box mod_box_game ">
			<div class="mod_daye">
				<div class="daye_for">
					为<span class="hl">YINKAIKAIKAI</span>打野赢大奖
				</div>
				<div class="daye_energy">
					<img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar" />
					<span class="t1">KDDD攻击次数</span>
					<span class="num" id="attack_num">0</span>
				</div>
				<div class="daye_time">
					<span class="min">00</span><i class="gap">:</i><span class="sec">10</span>
				</div>
				<!-- <div class="daye_progress">
					<div class="value" style="width:100%"></div>
				</div> -->
				<div class="daye_canvas">
					<video class="game_video" autoplay preload src="1.mp4" id="game_video" webkit-playsinline playsinline></video>
					<div class="canvas_wrap">
						<img src="https://puui.qpic.cn/vupload/0/20180104_1515075216227.png/0" alt="" class="game_pic" />
						<canvas class="game_canvas" id="game_canvas" width="900" height="600"></canvas>
					</div>
					<div class="touch_canvas" id="touch_canvas"></div>
					<div class="box"></div>
					<div class="box_tip"></div>
					<div class="light"></div>
					<div class="hand"></div>
					<button class="btn_play">开始打怪</button>
					<button class="btn_play_again">再玩一次</button>
				</div>
				
				<div class="daye_video"></div>
				

				<div class="daye_tips">
					<span class="text">点击屏幕开始游戏</span>
				</div>
			</div>
	
			<div class=" mod_teammate">
				<h2 class="mod_title">看谁是最佳队友</h2>
				<div class="mod_subtitle">每日凌晨更新榜单</div>
				<div class="team_list">
					<div class="mod_empty">
						<img class="icon_empty" src="https://puui.qpic.cn/vupload/0/20180106_1515221684713.png/0" alt="" />
						<span class="text">暂无榜单信息</span>
					</div>
				</div>
				<div class="team_list">
					<div class="team_item">
						<span class="rank_num rank_num_1">1</span>
						<img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar" />
						<div class="text">YIKAIKAI</div>
						<span class="label">10000次输出</span>
					</div>
					<div class="team_item">
						<span class="rank_num rank_num_2">2</span>
						<img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar" />
						<div class="text">YIKAIKAI</div>
						<span class="label">10000次输出</span>
					</div>
					<div class="team_item">
						<span class="rank_num rank_num_3">3</span>
						<img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar" />
						<div class="text">YIKAIKAI</div>
						<span class="label">10000次输出</span>
					</div>
					<div class="team_item">
						<span class="rank_num rank_num_4">4</span>
						<img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar" />
						<div class="text">YIKAIKAI</div>
							<span class="label">10000次输出</span>
						</div>	
				</div>
				
			</div>
		</div>
		

		<div class="mod_box mod_lottery">
			<h2 class="mod_title">丰富大礼等你领</h2>
			<div class="mod_desc">每周五更新奖品</div>
			<div class="float_notice">
				<marquee class="marquee" behavior="scroll" direction="left" scrollamount="5">
					<span class="item">kdd刚刚抽到后裔</span>
					<span class="item">任平生刚刚抽到李元芳</span>
				</marquee>
			</div>
			<div class="lottery_list">
				<div class="lottery_item lottery_item1">
					<div class="lottery_box">
						<img width="40" src="http://img1.gtimg.com/v/pics/hv1/2/151/2093/136135832.png"> 
						<p>oppo手机</p>
					</div>
				</div>
				<div class="lottery_item lottery_item2">
					<div class="lottery_box">
						<img width="40" src="http://i.gtimg.cn/qqlive/images/20160415/i1460722118_1.jpg"> 
						<p>恭喜您获得腾讯视频VIP 7天</p>
					</div>
				</div>
				<div class="lottery_item lottery_item3">
					<div class="lottery_box">
						<img width="40" src="http://p.qpic.cn/vshpic/0/C7E70A92603BA00934467353888F653D1506781035/0"> 
						<p>恭喜您获得腾讯视频VIP 3天</p>
					</div>
				</div>
				<div class="lottery_item lottery_item4">
					<div class="lottery_box">
						<img width="40" src="http://img1.gtimg.com/v/pics/hv1/2/151/2093/136135832.png"> 
						<p>恭喜您获得绿钻QQ公仔</p>
					</div>
				</div>
				<div class="lottery_item lottery_item5">
					<div class="lottery_box">
						<img width="40" src="http://i.gtimg.cn/qqlive/images/20160415/i1460722118_1.jpg"> 
						<p>恭喜您获得kindle</p>
					</div>
				</div>
				<div class="lottery_item lottery_item6">
					<div class="lottery_box">
						<img width="40" src="http://p.qpic.cn/vshpic/0/C7E70A92603BA00934467353888F653D1506781035/0"> 
						<p>王者礼包大</p>
					</div>
				</div>
				<div class="lottery_item lottery_item7">
					<div class="lottery_box">
						<img width="40" src="http://p.qpic.cn/vshpic/0/9182A64274AB4E8CE2B5896551EE29C51491556606/0"> 
						<p>恭喜您获得测试3</p>
					</div>
				</div>
				<div class="lottery_item lottery_item8">
					<div class="lottery_box">
						<img width="40" src="http://p.qpic.cn/vshpic/0/C7E70A92603BA00934467353888F653D1506781035/0"> 
						<p>物品2</p>
					</div>
				</div>
				<!----><!----> 
				<div class="lottery_item lottery_action">
					<button class="btn_lottery">开始</button> 
					<p class="num_tips">每次消耗<i class="icon_crystal"></i>10</p>
				</div>
			</div>
		</div>

		<div class="mod_box mod_task">
			<h2 class="mod_title">做任务集能量值</h2>
			<div class="mod_desc">每天做任务可以获得更多能量值</div>
			<div class="task_list">
				<div class="task_item">
					<div class="title">前往doki为爱豆签到</div>
					<div class="desc">前往明星doki加入并签到获10能量值</div>
					<button class="btn disabled">今天已完成</button>
				</div>
				
				<div class="task_item">
					<div class="title">前往doki为爱豆签到</div>
					<div class="desc">前往明星doki加入并签到获10能量值</div>
					<button class="btn">前往<span class="num">(0/3)</span></button>
				</div>
				
				<div class="task_item">
					<div class="title">分享给好友</div>
					<div class="desc">前往明星doki加入并签到获10能量值</div>
					<button class="btn">前往<span class="num">(0/3)</span></button>
				</div>
				
			</div>
		</div>
		

		<div class="mod_box mod_video_list">
			<div class="mod_title">重磅热播</div>
			<div class="mod_figure">
				<div class="figure_item">
					<a href="#" class="figure">
						<img src="https://puui.qpic.cn/vupload/0/common_blank.png/0 " alt="" class="figure_pic">
					</a>
					<div class="figure_title">王者出击第二集</div>
					<div class="figure_desc">幕后花絮：林志玲骑牛被狂</div>
				</div>
				
				<div class="figure_item">
					<a href="#" class="figure">
						<img src="https://puui.qpic.cn/vupload/0/common_blank.png/0 " alt="" class="figure_pic">
					</a>
					<div class="figure_title">王者出击第二集</div>
					<div class="figure_desc">幕后花絮：林志玲骑牛被狂</div>
				</div>
				<div class="figure_item">
					<a href="#" class="figure">
						<img src="https://puui.qpic.cn/vupload/0/common_blank.png/0 " alt="" class="figure_pic">
					</a>
					<div class="figure_title">王者出击第二集</div>
					<div class="figure_desc">幕后花絮：林志玲骑牛被狂</div>
				</div>
				<div class="figure_item">
					<a href="#" class="figure">
						<img src="https://puui.qpic.cn/vupload/0/common_blank.png/0 " alt="" class="figure_pic">
					</a>
					<div class="figure_title">王者出击第二集</div>
					<div class="figure_desc">幕后花絮：林志玲骑牛被狂</div>
				</div>

			</div>
		</div>
		
		<div class="foot_logo"><a><img src="http://vm.gtimg.cn/tencentvideo/vstyle/mobile/topic/wzcj_v2/style/img/logo1.png" width="95" class="pic"></a> <a><img src="http://vm.gtimg.cn/tencentvideo/vstyle/mobile/topic/wzcj_v2/style/img/logo2.png" width="104" class="pic"></a> <a><img src="http://vm.gtimg.cn/tencentvideo/vstyle/mobile/topic/wzcj_v2/style/img/logo3.png" width="73" class="pic"></a></div>

		<div class="mod_float_bar ">
			<div class="author">
				<img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar" />
				<i class="account_qq "></i>
				<i class="account_wechat none"></i>
			</div>
			<div class="author_meta">
				<i class="icon_vip icon_vip_lv6"><i class="icon_vip_num"></i></i>
				<a href="javascript:;" class="change">切换</a>
			</div>
			<div class="author_energy">
				已获得<i class="icon_crystal"></i><span class="num">1000</span>
			</div>
			<button class="btn_invite">邀请好友打野</button>
		</div>

		<div class="pop_start ">
			<div class="pop_inner">
				<div class="pics">
					<div class="pic pic_1">
						<img src="../style/img/am1.png" alt="" />
					</div>
					<div class="pic pic_2">
						<img src="../style/img/am2.png" alt="" />
					</div>	
				</div>
				
				<div class="start_subtitle">
					快为 <img src="http://i.gtimg.cn/qqlive/images/20150608/avatar.png" class="avatar"> <span class="name">YINKKKK</span>
				</div>
				<div class="start_title">
					<img src="https://puui.qpic.cn/vupload/0/20180103_title.png/0" alt="" />
				</div>

			</div>
		</div>


		<div class="pop_mask none"></div>

		<section class="mod_dialog mod_dialog_rule "><div class="dialog_box"><header class="dialog_head"><h3>活动规则</h3> <i class="icon_close"></i></header> <div class="dialog_content dialog_content_scroll"><div class="text_rule"><p>1、2016年1月11日-2016年1月24日期间，每位客户限抽1次。</p> <p>2、实物奖品抽中后，我们将为您免费配送至所选体验馆；到货后请凭中奖手机号（带手机）到店自提。在接到领奖通知次日起，7天内未领取的，直接取消领奖资格，实物奖品不退换、不补件。</p> <p>3、红包奖品发放：抽中红包后，红包序列号将以短信形式发送至手机，请注意查收。</p> <p>4、红包使用方法：凭序列号短信到对应体验馆在体验馆人员帮助下下单使用。</p> <p>5、红包使用条件：红包不能抵扣快递、物流或服务费；体验馆特卖、团购、拍卖、秒杀产品及第三方配送产品除外。每个订单只能使用一个红包，本红包不能与其他红包/预约券/抵扣券/优惠码同时使用。</p> <p>6、红包使用时间：使用本抽奖红包的订单不再享受活动满减优惠。</p> <p>7、红包注意事项：此红包仅限抽奖获得，不找零、不折现，限一次性使用完；如使用后发生退款，红包金额不作为退款款项。</p> <p>8、其他：抽中“精美到店礼品”的客户，直接到所选体验馆领取即可，数量有限，先到先得。</p></div></div></div></section>

		<section class="mod_toast "><div class="mod_toast_content"><p>asd</p></div></section>

		<section class="mod_dialog mod_dialog_gift ">
			<div class="dialog_box">
				<div class="rays"></div>
				<header class="dialog_head"><h3>奖品</h3> <i class="icon_close"></i></header> 
				<div class="dialog_content">
					<p class="text"><span class="hl">攻击次数</span></p>
					<div class="box_num">
						100
					</div>
					<p class="desc">当前排名第<span class="hl">15</span>名</p>
					<button class="btn">关闭</button>  
				</div>
			</div>
		</section>

		<!--  -->
		<div class="pop_modal none">
			<div class="pop_alert">
				<div class="pop_inner">
					<div class="pop_bd">
						<div class="pop_desc">确定要切换账户吗？</div>
					</div>
					<div class="pop_fd">
						<div class="pop_btns">
							<a href="javascript:void(0);" class="pop_btn"><span class="btn_inner">暂不切换</span></a>
							<a href="javascript:void(0);" class="pop_btn pop_btn_em"><span class="btn_inner">切换</span></a>
						</div>
					</div>
				</div>
			</div>	
		</div>

		<div class="pop_share none">
			<img src="https://puui.qpic.cn/vupload/0/20180105_1515134091772.png/0" alt="" class="share_pic" />
		</div>

		<!-- <div class="touch_area"></div> -->

		<!-- 展示横屏是 show -->
		<div class="pop_landscape ">
			<div class="icon_landscape"></div>
			<div class="text">为了更好的体验，请使用竖屏浏览</div>
		</div>
	</div>

	<div class="pop_loading none">
		<img src="https://puui.qpic.cn/vupload/0/20180106_1515408452611.png/0" alt="" class="pic" />
		<div class="loading_wrap">
			<div class="value" style="width: 0%"></div>
		</div>
		<div class="loading_text">0%</div>
	</div>


<script src="../js/zepto.js"></script>
<script src="../js/video.js"></script>
<script>

	// 射线的动画
	for (var i = 0; i < 20; i++) {

		$('.rays').append('<div class="ray"><div class="ray_inner"></div></div>');
		var num1 = Math.random(),num2 = Math.random(),num3= Math.random(),num4 =  Math.random();
		var d = Math.ceil(18*(i-1)+18*num1);
		var scale = (0.4 + num2).toFixed(3);

		$('.rays .ray').eq(i).css('-webkit-transform','rotate('+d+'deg) scale('+scale+')');
		$('.rays .ray_inner').eq(i).css({'-webkit-animation-delay':num3+'s','-webkit-animation-duration':num4/2+0.9+'s'});
	}


	
	// 非首次进入
	$('.mod_box_game').addClass('game_before');
	$('html').removeClass('noscroll')
	


	// 预加载视频
	var _video = $('#game_video')[0];
	if (typeof WeixinJSBridge == "object") {
			WeixinJSBridge.invoke("WeixinJSBridgeReady", {}, function(e) {
				_video.play();
			});
	} else {
			document.addEventListener("WeixinJSBridgeReady", function(e) {
				_video.play();
			}, false);
			$('html').on("click",function(e){
				_video.play();
				e.preventDefault();
			}, false);
	}
	


	// 阻止页面滚动
	$('.noscroll').on("touchmove",noScroll, false);

	function noScroll(e){
		// console.log('body touchemove ');
		e.preventDefault();
		return false;
	}


	// 活动引导
	$(".pop_start").click(function(){
		$(".pop_start").addClass('none');
		// 开始游戏之前
		$(".mod_box_game").addClass('game_active game_guide');
		$(".pop_mask").removeClass('none');
	})


	var trail = {
		dots: null,
		mousex:0,
		mousey:0,
		length: 15,
		Dot: function(){
			var oDot = document.createElement("div");
			$(oDot).addClass("touch_area");
			$(document.body).append(oDot);
			return oDot;
		},

		createDots: function(){
			trail.dots = [];
			for(i=0;i<trail.length;i++){
				var dot = new trail.Dot();          
				$(dot).css({
					opacity: (trail.length-i)/trail.length,
					display: 'none'
				});
				trail.dots[i]= dot;
			}
		},
		
		follow: function(tx, ty, dot){
			var dotx = parseInt($(dot).css("left"));
			var doty = parseInt($(dot).css("top"));
			var newx = ((tx+dotx*2)/3);
			var newy = ((ty+doty*2)/3);
			
			$(dot).css({top:newy, left:newx});    
		},
		
		move: function(){
			trail.follow(trail.mousex, trail.mousey, trail.dots[0]);
			
			for(i=1;i<trail.length;i++){
				dot = trail.dots[i-1];
				var tx = parseInt($(dot).css("left"));
				var ty = parseInt($(dot).css("top"));
				trail.follow(tx,ty, trail.dots[i]);
			}
		},
		mousemove: function(mx,my){
			trail.mousex = mx;
			trail.mousey = my;
		},
		
		initialize: function(){
			trail.createDots();
			setInterval(function(){ trail.move(); }, 4);
		}
	};
			
	trail.initialize();


	// 打怪兽的动作
	var $boss = $('#touch_canvas');
	var $modBoxGame = $('.mod_box_game');
	var timer = 5;
	var TimeCountDown;
	

	var moveStep = 0 ;
	var clientX, clientY, lastX, lastY;
	AlphaVideo('1.mp4', true);


	function startGame(){
		moveStep = 0;

		$modBoxGame.removeClass('game_before game_guide').addClass('game_playing');
		// 开始怪兽移动的动画
		
		clearInterval(TimeCountDown);

		// 倒计时
		TimeCountDown = setInterval( function(){
			
			if( timer < 1 ){
				$('.daye_time .sec').text('00');

				// 隐藏移动轨迹
				$(".touch_area").css({
					'display': 'none',
				})
				
				// 倒计时结束, 如果滑动了20次，则认为打败了怪兽
				if ( moveStep > 20 ){
					// 播放怪兽消失动画，不需要了，用css实现消失
					// AlphaVideo('2.mp4', false);
					$modBoxGame.addClass('game_played').removeClass('game_playing');

					// 出现盒子动画
					setTimeout(function(){
						$modBoxGame.addClass('game_last');
					},500)
				}else{
					// 没有打败怪兽，出现再玩一次
					$modBoxGame.removeClass('game_last game_before game_active').addClass('game_over');
					$(".pop_mask").addClass('none');

					$('html').removeClass('noscroll');
					$('html').unbind("touchmove",noScroll, false);
				}
				

				clearInterval(TimeCountDown);
			}else{
				timer--;
				
				$('.daye_time .sec').text(timer < 10 ? '0' + timer : timer);
			}
		}, 1000);
	}
	
	// 开始打怪兽
	$('.daye_canvas').click(function(){
		// 开始打怪兽
		if( ($modBoxGame.hasClass('game_before') || $modBoxGame.hasClass('game_guide') || $modBoxGame.hasClass('game_start')) && !$modBoxGame.hasClass('game_played') ){
			startGame();
		}
		
	})

	// 在怪兽上移动手指
	$boss.on('touchstart', function(e){
		e.preventDefault();
		if( $modBoxGame.hasClass('game_playing') ){
			console.log('canvas touchemove start', e);
			clientX = lastX = e.touches[0].clientX;
			clientY = lastY = e.touches[0].clientY;
		}
	}, false);

	$boss.on('touchmove', function(e){
		e.preventDefault();
		

		if( $modBoxGame.hasClass('game_playing') && timer > 0 ){
			// 显示移动轨迹
			trail.mousemove(e.changedTouches[0].pageX, e.changedTouches[0].pageY);


			var deltaX, deltaY;
			// console.log('canvas touchemove end', e);

			$(".touch_area").css({
				'display': 'block',
			})
			
			if( Math.abs(e.changedTouches[0].clientX - clientX) > Math.abs(lastX - clientX)){
				lastX = e.changedTouches[0].clientX;
			}else{
				deltaX = lastX - clientX;
				console.log('deltaX ', deltaX);
				// 如果互动具体 x or y 大于 30 ，则认为有效
				if( Math.abs(deltaX) > 90  ){
					moveStep++
				}
				$('#attack_num').text(moveStep)
				console.log('moveStep', moveStep);

				clientX = lastX;
			}

			// if( Math.abs(e.changedTouches[0].clientY - clientY) > Math.abs(lastY - clientY) ){
			// 	lastY = e.changedTouches[0].clientY;
			// }else{
			// 	deltaY = lastY - clientY;
			// 	console.log('deltaY ', deltaY);
			// 	// 如果互动具体 x or y 大于 30，则认为有效
			// 	if( Math.abs(deltaY) > 200  ){
			// 		moveStep++
			// 	}
			// 	$('#attack_num').text(moveStep)
			// 	console.log('moveStep', moveStep);

			// 	clientY = lastY;
			// }

			
		}else{
			// 隐藏移动轨迹
			$(".touch_area").css({
				'display': 'none',
			})
		}

		return false;

	}, false);

	$boss.on('touchend', function(e){
		e.preventDefault();
		// 隐藏移动轨迹
		$(".touch_area").css({
			'display': 'none',
		})
	}, false);

	// 再玩一次
	$('.btn_play_again, .btn_play').click(function(){
		$modBoxGame.removeClass('game_played game_over').addClass('game_active game_start');
		$(".pop_mask").removeClass('none');;


		$('html').addClass('noscroll');
		$('.noscroll').on("touchmove",noScroll, false);

		timer = 5;
		startGame();
	})


	// 打开盒子
	$('.mod_daye .box').click(function(){

		$('.mod_dialog_gift').addClass('show');

		$(".mod_box_game").removeClass('game_last game_before game_active').addClass('game_over');
		$(".pop_mask").addClass('none');
		

		$('html').removeClass('noscroll');
		$('html').unbind("touchmove",noScroll, false);
	})

	$(".mod_dialog_gift").click(function(){
		// $(".mod_box_game").removeClass('game_last game_before game_active');
		$('.mod_dialog_gift').removeClass('show');
	})

	// 分享提示
	$('.pop_share').click(function(){
		$('.pop_share').addClass('none');
	})


	// loading 浮层
	function loading(){
		var loadingVideo = document.getElementById('game_video');
		var req = new XMLHttpRequest();
		// 视频地址
    var src = '1.mp4'
    req.open('GET', src, true);
    req.responseType = 'blob';
    req.send();
    req.onload = function() {
        if (this.status == 200) {
            var vid = URL.createObjectURL(this.response);
            loadingVideo.setAttribute("src", vid);
        }
    }
    req.onprogress = function(e) {
        if (e.lengthComputable) {
						var percentComplete = ((e.loaded / e.total) * 100 | 0);
						$('.pop_loading .loading_wrap .value').css({
							width: `${percentComplete}%`
						})
						$('.pop_loading .loading_text').html( `${percentComplete}<span class="unit">%</span>`)

						if( percentComplete  == 100 ){
							$('.pop_loading').addClass('none');

							$('.pop_start').removeClass('none');
						}
				}
			
    }
	}

	// loading();
	

</script>
</body>
</html>
