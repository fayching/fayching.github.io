<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<title>最受欢迎视频榜323333</title>
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui,viewport-fit=cover" />
<link rel="stylesheet" href="../style/css/rank.css"/>
<style>
.container{
	overflow: visible;
}
</style>
</head>
<body ontouchstart>

	<div class="page_bg">
		<i class="bg_dec1"></i>
		<i class="bg_dec2"></i>
		<i class="bg_dec3"></i>
		<i class="bg_dec4"></i>
	</div>
	<!-- container_share -->
	<header class="page_title">
		<div class="title_moker">
			<span class="title_left"></span><span  class="title_right"></span>
		</div>
	</header>
	<div class="container">

		<section class="moker_list">
			<header class="period_title">第10期 12/25-12/31 <div class="link_rule">怎么上榜</div></header>

			<ul class="first_three_moker">
				<li class="moker_item rank_num2">
					<div class="moker_item_bg"></div>
					<i class="num">2</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?112x112"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>

				</li>
				<li class="moker_item rank_num1">
					<div class="moker_item_bg"></div>
					<i class="num">1</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?112x112"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item rank_num3">
					<div class="moker_item_bg"></div>
					<i class="num">3</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?112x112"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
			</ul>
			<ul class="common_moker_list">
				<li class="moker_item">
					<i class="num">4</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">5</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">6</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">7</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">8</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">9</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">10</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
				<li class="moker_item">
					<i class="num">888</i>
					<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
					<div class="name">哇叽哇叽哇叽哇叽</div>
					<div class="score"><i class="icon_hot"></i>90.1</div>
				</li>
			</ul>
		</section>
	</div>
	<section class="moker_item moker_user">
		<i class="num">-</i>
		<div class="avatar"><img src="//tacs_v1.oa.com/img.php?88x88"></div>
		<div class="name">哇叽哇叽哇叽哇叽</div>
		<div class="score"><i class="icon_hot"></i>90.1</div>
	</section>
	<section class="mod_dialog dialog_rule">
		<div class="mod_dialog_content">
			<i class="icon_arrow"></i>
			<h3 class="title">Moker榜（周榜）怎么上榜</h3>
			<div class="rule_content">
				<h4>1. 总规则</h4>
				<p>针对每个用户在榜单统计周期内发布的所有视频，累加视频播放量、蘑菇数、评论数，通过公式计算该用户所有视频获得的总得分，取得分最高的前10名用户上榜。榜单每小时更新一次，每周日0:00生成该周榜单结果。</p>

				<h4>2. 榜单周期</h4>
				<p>- 数据统计周期：每周日0:00-周六23:59 （连续7天）- 结果展示周期：每周日0:00-23:59（1天）生成并在榜单入口展示结果</p>
					<p>- 滚动打榜周期：每周一0:00-周六23:59（数据从周日开始算起）分数组成周期内发布的所有视频的总播放量：50%周期内上述视频获得的蘑菇数：30%周期内上述视频获得的评论数：20%计分公式单项指标分数计算：单项分数满分为所占比例值，单项的第一名获得满分，其他名次按照统计数据与第一名的占比取自然对数取相对分。即公式为：单项分数=单项满分×ln（单项指标数据）/ln(单项指标上的最高数据)
					</p>

				<h4>3. 分数组成</h4>
				<p>周期内发布的所有视频的总播放量：50%周期内上述视频获得的蘑菇数：30%周期内上述视频获得的评论数：20%计分公式单项指标分数计算：单项分数满分为所占比例值，单项的第一名获得满分，其他名次按照统计数据与第一名的占比取自然对数取相对分。即公式为：单项分数=单项满分×ln（单项指标数据）/ln(单项指标上的最高数据)</p>

				<h4>4.计分公式</h4>
				<p>单项指标分数计算：单项分数满分为所占比例值，单项的第一名获得满分，其他名次按照统计数据与第一名的占比取自然对数取相对分。即公式为：单项分数=单项满分×ln（单项指标数据）/ln(单项指标上的最高数据)</p>
			</div>
		</div>
	</section>
	<script type="text/javascript" src="../js/zepto.js"></script>
	<script type="text/javascript" src="../js/transform.js"></script>
	<script  type="text/javascript" src="../js/alloy_touch.js"></script>
	<script type="text/javascript">
	var bg_dec1 = $('.bg_dec1')[0],
	bg_dec2 = $('.bg_dec2')[0],
	bg_dec3 = $('.bg_dec3')[0],
	bg_dec4 = $('.bg_dec4')[0];
	Transform(bg_dec1);
	Transform(bg_dec2);
	Transform(bg_dec3);
	Transform(bg_dec4);
	var container = $('.container')[0];
	Transform(container);
	var title_left = $('.title_left')[0];
	Transform(title_left);
	var title_right = $('.title_right')[0];
	Transform(title_right);
	var rank_num1 = $('.rank_num1 .moker_item_bg');
	var height = rank_num1.height();
	var startY,lastY,
        isTouchStart = false,
        direction;




	$('body').on('touchstart', function (e) {

		isTouchStart = true;
		startY = e.changedTouches[0].pageY;
    });
	$('body').on('touchmove',function (e) {

		console.log($(window).scrollTop())
        if ( isTouchStart ){
			lastY = e.changedTouches[0].pageY;
			var offset = lastY - startY;

			console.log($(window).scrollTop())
            if(offset > 0 ){
                direction = "down";
				// if(offset > 200){
				// 	offset = 200;
				// }

				if($(window).scrollTop()<= 0){
					e.preventDefault();
					e.returnValue = false;
					container.translateY= offset*0.5;
					bg_dec1.translateY= offset*0.8;
					bg_dec2.translateY= offset*0.7;
					bg_dec3.translateY= offset*0.7;
					bg_dec4.translateY= offset*0.6;
					$('.rank_num1 .num').removeClass('fadeIn').addClass('fadeOut');
					rank_num1.height(height+offset/3);
				}else{
					e.returnValue = true;
				}
				title_left.translateY= offset*0.5;
				if(offset>24){
					title_right.translateY= offset*0.5 + 6;
				}else{
					title_right.translateY= (offset*0.5 + offset/4).toFixed(2);
				}
			}

			if(offset < 0 ){
				direction = "up";
				var v = -$(window).scrollTop();
				// title_right.translateY= v*0.5;
				if(v<-24){
					title_left.translateY=-6;
				}else if(v<0){
					title_left.translateY= (v/4).toFixed(2);
				}


			}
		}
	});
	$(window).scroll(function() {
		if($(window).scrollTop()<= 0){
			var v = -$(window).scrollTop();
			if(v<-24){
				title_left.translateY=-6;
			}else if(v<0){
				title_left.translateY= (v/4).toFixed(2);
			}
		}
	});
	$('body').on('touchend',function (e) {
		lastY = e.changedTouches[0].pageY;
		var offset = lastY - startY;
        var time = offset*2;

		if(isTouchStart){

			to(container, 'translateY', 0, time, iosEase);
			setTimeout(function () {
				$('.container').css('transform','none');
			},time)
			to(title_left, 'translateY', 0, time, iosEase);
			to(title_right, 'translateY', 0, time, iosEase);
			to(bg_dec1, 'translateY', 0, time, iosEase);
			to(bg_dec2, 'translateY', 0, time, iosEase);
			to(bg_dec3, 'translateY', 0, time, iosEase);
			to(bg_dec4, 'translateY', 0, time, iosEase);
			toHeight(rank_num1, height, time, iosEase);
			$('.rank_num1 .num').removeClass('fadeOut').addClass('fadeIn');
			isTouchStart = false;
		}
	});


    function iosEase(x) {
        return Math.sqrt(1 - Math.pow(x - 1, 2));
    }

    var tickID = 0
    function to(el, property, value, time, ease, onEnd) {
        var current = el[property];
        var dv = value - current;
        var beginTime = new Date();
        var toTick = function () {

            var dt = new Date() - beginTime;
            if (dt >= time) {
                el[property] = value;
                onEnd && onEnd(value);
                return;
            }
            el[property] = dv * ease(dt / time) + current;
            tickID = requestAnimationFrame(toTick);

        }
        toTick();
    };
	function toHeight(el, value, time, ease, onEnd){
		var current = el.height();
        var dv = value - current;
        var beginTime = new Date();
        var toTick = function () {

            var dt = new Date() - beginTime;
            if (dt >= time) {
                el.height(value);
                onEnd && onEnd(value);
                return;
            }
            el.height( dv * ease(dt / time) + current);
            tickID = requestAnimationFrame(toTick);

        }
        toTick();
	}
	</script>
</body>
</html>
